<section class="container-fluid">

  <section class="workspace-sec">
    <div class="bodycon pb-3 mb-5">
      <div class="container-fluid">
        <div class="d-inline" *ngFor="let upstream of upStreamPortals;">
          <button (click)="upStreamPortal=upstream?.portalID;getProducts()" style="height: 40px;margin-right: -4px;" class="btn tab-btn active">{{upstream?.portalName}}</button>
        </div>
        <section class="table-search-div">

          <div class="date-search">
            <div class="form-group-item">
              <label>From</label>
              <div class="">
                <input (click)="d.toggle()" id="datepicker" width="220" placeholder="yyyy-mm-dd" [(ngModel)]="fromDate"
                       name="dp" ngbDatepicker
                       #d="ngbDatepicker">
              </div>
            </div>
            <div class="form-group-item">
              <label>To</label>
              <div class="">
                <input (click)="d1.toggle()" id="datepicker1" width="140" placeholder="yyyy-mm-dd" [(ngModel)]="toDate"
                       name="dp" ngbDatepicker
                       #d1="ngbDatepicker">
              </div>
            </div>
            <div class="form-group mb-0">
              <button class="btn load-from-source" (click)="loadFromSource()">
                Load From Source
              </button>
            </div>
          </div>
          <div class="keyword-search">
            <div class="form-group mb-0">
              <form class="form-inline" name ="searchForm" action="">
                <label for="email">
                  <span class="Keyword mr-2">Keyword</span>
                </label>
                <input
                  type="text"
                  name = "orderNumber"
                  [(ngModel)]="orderNumber"
                  class="form-control mr-3 keyinput-val"
                  placeholder="Enter keyword"
                  id="email"
                />
                <button *ngIf="!isSearched" (click)="filterByOrderNumber()" class="btn search-btn">Search</button>
                <button type="submit" *ngIf="isSearched" class="btn btn-primary loadSource" (click)="clearTableData()">Clear</button>
              </form>
            </div>
            <div class="form-group mb-0"></div>
          </div>
          <div class="sortby-search">
            <div class="row">
              <div class="col-8">
                <div class="form-group-item-2">
                  <label><span class="sort-by-txt">Sort By</span></label>
                  <select class="select-bg" (change)="sortData($event.target.value)">
                    <option value="">Select</option>
                    <option value="collections">Collections</option>
                    <option value="details">Details</option>
                    <option value="markup">Markup</option>
                    <option value="orderNumber">Order Number</option>
                    <option value="productType">Product Type</option>
                    <option value="title">Style</option>
                    <option value="unitPriceWithShippingFee">Unit Price</option>
                  </select>
                </div>
                <div class="form-group-item-2">
                  <label><span class="status-txt">Status</span></label>
                  <select class="select-bg" (change)="filterData($event.target.value)" >
                    <option value="">Select</option>
                    <option *ngFor="let status of uniqueStatuses">{{status}}</option>
                  </select>
                </div>
              </div>
              <div class="col-4">
                <div class="d-flex align-items-center mh90">
                  <button class="btn refresh-btn" (click)="getProducts()">Refresh</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <div class="tableFixHead d-block">
          <table>
            <thead>
            <tr>
              <th>S.No</th>
              <th>Select</th>
              <th>Style</th>
              <th>Product Details</th>

              <th>Product Type</th>

              <th>Collection</th>
              <th>Tags</th>
              <th>SKU</th>
              <th>Unit Price
                <small>(Inc. shipping)</small></th>
              <th>Markup</th>

              <th>Sale Price</th>
              <th>Order
                Number
              </th>
              <th>Status</th>
              <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let item of pagedItems;let i =index;">
              <td align="center" class="snoTd">{{i + 1}}</td>
              <td align="center">
                <input type="checkbox" (click)="selectProduct($event,item)">
              </td>
              <td class="styleTd">
                <div class="styleImg">
                  <img style="cursor:pointer;" (click)="details(item?.productID)"
                       [src]="getImage(item?.photos)"/></div>
                <h6 style="cursor:pointer;" (click)="details(item?.productID)" class="styleName">{{item?.title}}</h6>
              </td>
              <td class="pdTd">
               <textarea style="width:100%;resize: none;font-size: 10px" rows=10 cols=40
                         [(ngModel)]="item.details">{{item?.details}}</textarea>
                <span data-toggle="modal" data-target="#myModal1" style="cursor: pointer;
    bottom: 0;
    text-align: center;
    right: 10px;
    font-weight: bold;" (click)="selectDetIndex(item.productID)">...</span>
              </td>
              <td class="ptTd">
                <select class="form-control tableInput" [(ngModel)]="item.productType">
                  <option>Select Type</option>
                  <option *ngFor="let ptype of productTypes" [selected]="ptype === item?.productType">{{ptype}}</option>
                  <option value="other">Other</option>
                </select>
                <br>
                <input *ngIf="item.productType === 'other'" type="text" class="form-control"
                       [(ngModel)]="item.productTypeOther">
              </td>
              <td class="ptTd">
                <select class="form-control tableInput" [(ngModel)]="item.collections">
                  <option>Select Collection</option>
                  <option *ngFor="let collection of collections"
                          [selected]="collection === item?.collections">{{collection}}</option>
                  <option value="other">Other</option>
                </select>
                <br>
                <input *ngIf="item.collections === 'other'" type="text" class="form-control"
                       [(ngModel)]="item.collectionOther">
              </td>
              <td class="ptTags">
                <div class="ribbonTd" *ngFor="let tag of item?.tags;let j =index;">
              <span style="cursor:pointer;position: absolute;
    left: 5px;" (click)="removeFromList(item.id,tag)">X</span>
                  <span>  {{tag}}</span>
                </div>
                <p *ngIf="getTagsLength(item?.tags) > 2">...</p>
                <div class="ribbonTd1">
              <span style="cursor:pointer;width: 18px;
    height: 18px;" data-toggle="modal" data-target="#myModal"
                    (click)="selectIndex(item.productID)">+</span>

                </div>
              </td>
              <td class="ptTd">
                <input *ngIf="!checkStatus(item?.downstreamStatus)" [title]="item.skuDownstream" type="text" class="form-control" [(ngModel)]="item.skuDownstream">
                <span *ngIf="checkStatus(item?.downstreamStatus)" >{{item.skuDownstream}}</span>
              </td>
              <td class="unitPrice"><p>$ {{item?.unitPriceWithShippingFee}} </p></td>
              <td><input type="text" class="form-control markupInput" [(ngModel)]="item.markup"></td>
              <td align="center"><p>$ {{getSalePrice(item?.unitPriceWithShippingFee, item?.markup)}} </p></td>
              <td><p>{{item?.orderNumber}}</p></td>
              <td><p>{{item?.downstreamStatus || 'N/A'}}</p></td>
              <td>
                <button (click)="saveData(item)" class="btn saveBtn">Save</button>
              </td>
            </tr>
            </tbody>
          </table>
        </div>

        <div class="tablePagination mt-4 pt-1">
          <div class="table-footer-sec">
            <div class="item-1" >
              <div class="exported-txt">
                Last exported on 7th Dec 2020, 12:18:32 PM
              </div>

            </div>
            <div class="item-2">
              <div class="export-type">
                <select class="select-bg"  style="margin-right:30px;" [(ngModel)]="downStreamPortal" (change)="getProducts()">
                  <option *ngFor="let downStream of downStreamPortals;"
                          [value]="downStream?.portalID">{{downStream?.portalName}}</option>
                </select>
              </div>
              <button (click)="uploadProducts()" class="btn exportDestination">
                Export to Destination
              </button>
            </div>
            <ngb-pagination style="position: absolute;right: 0" [collectionSize]="pager.totalItems"
                            [pageSize]="pager.pageSize" [(page)]="pager.currentPage"
                            [maxSize]="3" [rotate]="false" (pageChange)="setPage(pager.currentPage)"
                            [boundaryLinks]="false"></ngb-pagination>

          </div>


        </div>
      </div>
    </div>
  </section>
</section>

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Add Tags</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <input #customtag class="form-control" type="text" placeholder="Add new tag">

          </div>
          <div class="col-md-6">
            <button class="btn btn-primary" (click)="addToTags(customtag)">Add</button>
          </div>
        </div>
        <div style="margin-top:20px;" class="row" *ngIf="isProdSelected">
          <div class="col-md-6" *ngFor="let tag of tags">
            <input type="checkbox" class="tags" [checked]="hasValue(tag)"
                   (click)="addToList($event.target.checked,tag)">
            <label style="margin-left: 10px !important; ">{{tag}}</label>

          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div style="float: left">
          <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="addListToProduct()">Add</button>
        </div>
        <div style="float: right">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Modal -->
<div id="myModal1" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Product Details</h4>
      </div>
      <div class="modal-body">
        <textarea rows="10" cols="58" [(ngModel)]="selectedProdDetails"></textarea>
      </div>
      <div class="modal-footer">
        <div style="float: left">
          <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="updateProductDetails()">Add
          </button>
        </div>
        <div style="float: right">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>

  </div>
</div>
<app-loading *ngIf="loading"></app-loading>
